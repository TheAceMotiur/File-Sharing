# Enable rewrite engine
RewriteEngine On

# Block access to sensitive files
RewriteRule ^(vendor|database|includes|chunks|cache|uploads)/.*$ - [F,L]
RewriteRule ^(\.git|composer\.(json|lock)|\.env)$ - [F,L]

# If the request is for a real file or directory, serve it directly
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Route all other requests through router.php
RewriteRule ^ router.php [L]

# Cache static assets for 1 week
<FilesMatch "\.(jpg|jpeg|png|gif|ico|css|js)$">
    Header set Cache-Control "max-age=604800, public"
</FilesMatch>

# Add CORS headers
Header set Access-Control-Allow-Origin "*"
Header set Access-Control-Allow-Methods "GET, OPTIONS"
Header set Access-Control-Allow-Headers "Origin, X-Requested-With, Content-Type, Accept, X-File-Name"

# Additional headers for proxy support
Header set X-Frame-Options "ALLOWALL"
Header set X-Content-Type-Options "nosniff"